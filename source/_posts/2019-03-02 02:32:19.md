---
title: SQL反模式
date: 2019-03-02 02:32:19
tags: 
summary: 
hash: 84dedfdf
desc: 
---
# 前言
这里是记录《SQL反模式》这本书的简单笔记。
SQL和分析就不一一列出，记录主要的思路。

# 第2章: 格式化的逗号分隔列表

1. 目标: 存储多值属性
2.  反模式: 格式化的逗号分隔列表
	缺点:  
	- 模式匹配可能返回错误结果，无法享受索引带来的性能优势。
	- 不利于聚合查询
	- 列表长度限制
	- 其它潜在隐患： 比如分隔符导致的出错

3. 解决方案：创建一张交叉表
![](/images/交叉表.png)
优点：联结查询变得更为高效，可以利用索引而不是正则表达式
依赖数据自身的约束来强制引用的完整性。交叉表可以记录更多的属性。

# 第3章： 单纯的树
1. 目标：分层存储与查询评论
2. 反模式： 添加父节点id字段
	![](/images/Screenshot_20190302_172134.png)

	邻接表，最普通、简单的方案用于记录分层数据。
	示例![](/images/Screenshot_20190302_172453.png)
	缺陷： 树的深度增加会带来很大问题。

3. 解决方案：使用其它树模型

	1.  路径枚举
	![](/images/Screenshot_20190302_172910.png)
	缺点：存在深度限制。需要维护路径
	2. 嵌套集
	使用深度优先遍历编码节点以存储子孙节点的信息。
	![](/images/Screenshot_20190302_173307.png)
	例如：通过搜索评论6在哪个节点的nsleft和nsright范围之内，可以轻松获取其祖先。
	删除节点不会对树的结构产生影响。

	缺点：频繁插入、删除节点比较复杂。
	3. 闭包表
	简单而优雅的解决方案
	![](/images/Screenshot_20190302_173819.png)

4. 总结
![](/images/Screenshot_20190302_174042.png)